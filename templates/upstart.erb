# -*- upstart -*-
##################################
# THIS FILE IS MANAGED BY PUPPET #
##################################
# /etc/init/devpi.conf
description "devpi"
<% if scope['devpi::proxy'] -%>
env http_proxy=<%= scope['devpi::proxy'] %>
env https_proxy=<%= scope['devpi::proxy'] %>
export http_proxy
export https_proxy
<% end -%>

start on runlevel [2345]
stop on runlevel [!2345]
respawn

exec sudo -E -u <%= scope['devpi::user'] %> <% unless scope['devpi::virtualenv'].empty? %><%= scope['devpi::virtualenv'] %>/bin/<% end %>devpi-server --host <%= scope['devpi::listen_host'] %> --port <%= scope['devpi::listen_port'] %> --serverdir <%= scope['devpi::server_dir'] %>
